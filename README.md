https://blog.the-pans.com/state-machine-and-sync/